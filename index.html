<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AITO AI å£°èª‰å…¨æ™¯ç›‘æµ‹ç³»ç»Ÿ (Pro)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel ç”¨äºè§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        
        body { font-family: 'Inter', 'Noto Sans SC', sans-serif; }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: #94a3b8; }

        /* éšè—æ¨ªå‘æ»šåŠ¨æ¡ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* åŠ¨ç”» */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fade-in-up 0.4s ease-out forwards; }
        
        /* ä¾§è¾¹æ æŠ˜å åŠ¨ç”» */
        .sidebar-collapsed {
            transform: translateX(-100%);
        }
        
        .sidebar-expanded {
            transform: translateX(0);
        }
        
        /* ç§»åŠ¨ç«¯é®ç½©å±‚ */
        .overlay {
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="bg-[#F0F2F5] text-slate-900 overflow-hidden">

    <div id="root"></div>

    <!-- React åº”ç”¨é€»è¾‘ -->
    <script type="text/babel" data-type="module">
        import React, { useState, useMemo } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            ShieldAlert, ShieldCheck, AlertTriangle, Search, ChevronRight, 
            Heart, TrendingUp, Zap, FileText, CheckCircle2, BarChart3, 
            Database, Battery, DollarSign, Lock, Users, Smartphone, 
            MapPin, Filter, Factory, Crown, Layers, Activity, MessageSquare,
            AlertCircle, Menu, X, ChevronLeft
        } from 'https://esm.sh/lucide-react@0.292.0?bundle';

        // --- æ ¸å¿ƒæ•°æ®æº (ä»å¤–éƒ¨JSONæ–‡ä»¶åŠ è½½) ---
        // æ•°æ®å°†ä» analysis_results/ai_reputation_analysis_20251119_163327.json åŠ¨æ€åŠ è½½

        // --- ç»„ä»¶ ---

        const StatusBadge = ({ status, text }) => {
          const styles = {
            high: "bg-red-100 text-red-700 border-red-200",
            warning: "bg-amber-100 text-amber-800 border-amber-200",
            safe: "bg-emerald-100 text-emerald-800 border-emerald-200",
          };
          
          const icons = {
            high: <ShieldAlert size={14} className="mr-1.5" />,
            warning: <AlertCircle size={14} className="mr-1.5" />,
            safe: <ShieldCheck size={14} className="mr-1.5" />,
          };

          return (
            <span className={`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold border ${styles[status] || styles.safe} transition-colors duration-200 shadow-sm`}>
              {icons[status]}
              {text}
            </span>
          );
        };

        const CategoryIcon = ({ category, className="" }) => {
          const map = {
            Brand: <Heart className={`text-rose-500 ${className}`} size={16} />,
            Tech: <Database className={`text-blue-500 ${className}`} size={16} />,
            Safety: <ShieldCheck className={`text-emerald-500 ${className}`} size={16} />,
            Product: <Smartphone className={`text-indigo-500 ${className}`} size={16} />,
            Service: <Zap className={`text-yellow-500 ${className}`} size={16} />,
            Crisis: <AlertTriangle className={`text-red-500 ${className}`} size={16} />,
            Value: <DollarSign className={`text-green-600 ${className}`} size={16} />,
            Privacy: <Lock className={`text-slate-500 ${className}`} size={16} />,
            Manufacturing: <Factory className={`text-purple-500 ${className}`} size={16} />,
            Competitor: <BarChart3 className={`text-orange-500 ${className}`} size={16} />,
            Eco: <Layers className={`text-cyan-500 ${className}`} size={16} />,
          };
          return map[category] || <FileText className={`text-slate-400 ${className}`} size={16} />;
        };

        const DetailSection = ({ title, icon: Icon, children, className = "" }) => (
          <div className={`mb-8 group ${className}`}>
            <h3 className="flex items-center text-[11px] font-bold text-slate-400 uppercase tracking-widest mb-3 border-b border-slate-100 pb-2 group-hover:text-blue-600 transition-colors">
              <Icon size={14} className="mr-2 text-slate-400 group-hover:text-blue-500 transition-colors" />
              {title}
            </h3>
            <div className="text-sm leading-7 text-slate-700">
              {children}
            </div>
          </div>
        );

        // --- ä¸»åº”ç”¨ ---

        const App = () => {
          const [selectedId, setSelectedId] = useState(null);
          const [filterStatus, setFilterStatus] = useState('all');
          const [data, setData] = useState([]);
          const [loading, setLoading] = useState(true);
          const [error, setError] = useState(null);
          // æ¡Œé¢ç«¯é»˜è®¤å±•å¼€ä¾§è¾¹æ ï¼Œç§»åŠ¨ç«¯é»˜è®¤å±•å¼€ä¾§è¾¹æ ï¼ˆé¦–æ¬¡åŠ è½½ï¼‰
          const [sidebarCollapsed, setSidebarCollapsed] = useState(false);
          const [showDetailOnMobile, setShowDetailOnMobile] = useState(false);

          // åŠ è½½å¤–éƒ¨JSONæ•°æ® - è‡ªåŠ¨åŠ è½½ analysis_results ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
          React.useEffect(() => {
            // é¦–å…ˆåŠ è½½æ–‡ä»¶ç´¢å¼•
            fetch('./analysis_results/files_index.json')
              .then(response => {
                if (!response.ok) throw new Error('æ— æ³•åŠ è½½æ–‡ä»¶ç´¢å¼•ï¼Œè¯·å…ˆè¿è¡Œ generate_index.py ç”Ÿæˆç´¢å¼•');
                return response.json();
              })
              .then(indexData => {
                if (!indexData.files || indexData.files.length === 0) {
                  throw new Error('ç´¢å¼•æ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ° JSON æ•°æ®æ–‡ä»¶');
                }
                
                // å¹¶è¡ŒåŠ è½½æ‰€æœ‰ JSON æ–‡ä»¶
                const filePromises = indexData.files.map(filename => 
                  fetch(`./analysis_results/${filename}`)
                    .then(response => {
                      if (!response.ok) throw new Error(`åŠ è½½å¤±è´¥: ${filename}`);
                      return response.json();
                    })
                    .then(jsonData => ({ filename, data: jsonData }))
                    .catch(err => {
                      console.error(`åŠ è½½æ–‡ä»¶ ${filename} å¤±è´¥:`, err);
                      return null;
                    })
                );
                
                return Promise.all(filePromises);
              })
              .then(filesData => {
                // è¿‡æ»¤æ‰åŠ è½½å¤±è´¥çš„æ–‡ä»¶
                const validFiles = filesData.filter(f => f !== null && f.data && Array.isArray(f.data));
                
                if (validFiles.length === 0) {
                  throw new Error('æ²¡æœ‰æˆåŠŸåŠ è½½ä»»ä½•æ•°æ®æ–‡ä»¶');
                }
                
                // åˆå¹¶æ‰€æœ‰æ–‡ä»¶çš„æ•°æ®
                let globalId = 1;
                const allTransformedData = [];
                
                validFiles.forEach(({ filename, data }) => {
                  const transformedData = data.map((item, index) => ({
                    id: globalId++,
                    category: getCategoryFromQuery(item.User_Query),
                    sourceFile: filename,
                    platform: item.Platform,
                    query: item.User_Query,
                    response: item.AI_Response,
                    analysis: {
                      security: {
                        status: getStatusFromLabel(item.Security_Status),
                        label: item.Security_Status,
                        reason: item.Risk_Diagnosis
                      },
                      diagnosis: item.Risk_Diagnosis,
                      factCheck: {
                        status: 'accurate',
                        text: item.Fact_Tech
                      },
                      brandImpression: {
                        score: getBrandScore(item.Brand_Impression),
                        label: item.Brand_Impression.split('åˆ†')[0] || 'ä¸­ç­‰',
                        text: item.Brand_Impression
                      },
                      compPosition: {
                        trend: getTrendFromPosition(item.Comp_Position),
                        text: item.Comp_Position
                      },
                      strategy: item.Strategy_Action
                    }
                  }));
                  allTransformedData.push(...transformedData);
                });
                
                console.log(`âœ… æˆåŠŸåŠ è½½ ${validFiles.length} ä¸ªæ–‡ä»¶ï¼Œå…± ${allTransformedData.length} æ¡æ•°æ®`);
                setData(allTransformedData);
                
                // æ¡Œé¢ç«¯å’Œå¹³æ¿ç«¯è‡ªåŠ¨é€‰ä¸­ç¬¬ä¸€é¡¹ï¼Œç§»åŠ¨ç«¯ä¸è‡ªåŠ¨é€‰ä¸­è®©ç”¨æˆ·ä¸»åŠ¨é€‰æ‹©
                if (allTransformedData.length > 0) {
                  if (window.innerWidth >= 768) {
                    setSelectedId(allTransformedData[0].id);
                  } else {
                    setSelectedId(null); // ç§»åŠ¨ç«¯åˆå§‹ä¸é€‰ä¸­
                  }
                }
                setLoading(false);
              })
              .catch(err => {
                setError(err.message);
                setLoading(false);
              });
          }, []);

          // è¾…åŠ©å‡½æ•°ï¼šä»æŸ¥è¯¢å†…å®¹æ¨æ–­åˆ†ç±»
          const getCategoryFromQuery = (query) => {
            if (query.includes('æ™ºé©¾') || query.includes('ADS') || query.includes('AEB')) return 'Tech';
            if (query.includes('å®‰å…¨') || query.includes('äº‹æ•…')) return 'Safety';
            if (query.includes('M7') || query.includes('M8') || query.includes('M9')) return 'Product';
            if (query.includes('æœåŠ¡')) return 'Service';
            if (query.includes('åä¸º') || query.includes('èµ›åŠ›æ–¯')) return 'Brand';
            if (query.includes('ç†æƒ³') || query.includes('è”šæ¥') || query.includes('æ¯”äºšè¿ª')) return 'Competitor';
            if (query.includes('ä»·æ ¼') || query.includes('å€¼')) return 'Value';
            return 'Product';
          };

          // è¾…åŠ©å‡½æ•°ï¼šä»çŠ¶æ€æ ‡ç­¾è·å–çŠ¶æ€å€¼
          const getStatusFromLabel = (label) => {
            if (label.includes('ğŸ”´') || label.includes('é«˜å±')) return 'high';
            if (label.includes('ğŸŸ¡') || label.includes('é¢„è­¦')) return 'warning';
            return 'safe';
          };

          // è¾…åŠ©å‡½æ•°ï¼šä»å“ç‰Œå°è±¡æå–åˆ†æ•°
          const getBrandScore = (text) => {
            const match = text.match(/(\d+(\.\d+)?)\s*åˆ†/);
            if (match) {
              const score = parseFloat(match[1]);
              return Math.min(5, Math.max(1, Math.round(score)));
            }
            return 3;
          };

          // è¾…åŠ©å‡½æ•°ï¼šä»ç«å“ç«™ä½è·å–è¶‹åŠ¿
          const getTrendFromPosition = (text) => {
            if (text.includes('ğŸ†') || text.includes('ä¼˜åŠ¿')) return 'up';
            if (text.includes('ğŸ“‰') || text.includes('åŠ£åŠ¿')) return 'down';
            return 'neutral';
          };

          const selectedItem = useMemo(() => data.find(item => item.id === selectedId), [selectedId, data]);
          
          const filteredData = useMemo(() => {
            if (filterStatus === 'all') return data;
            return data.filter(item => {
                if (filterStatus === 'high') return item.analysis.security.status === 'high';
                if (filterStatus === 'warning') return item.analysis.security.status === 'warning';
                if (filterStatus === 'safe') return item.analysis.security.status === 'safe';
                return true;
            });
          }, [filterStatus, data]);

          // Stats
          const highRisk = data.filter(i => i.analysis.security?.status === 'high').length;
          const warning = data.filter(i => i.analysis.security?.status === 'warning').length;
          const safe = data.filter(i => i.analysis.security?.status === 'safe').length;

          // åŠ è½½çŠ¶æ€
          if (loading) {
            return (
              <div className="flex h-screen bg-[#F0F2F5] items-center justify-center">
                <div className="text-center">
                  <div className="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mb-4"></div>
                  <p className="text-slate-600 font-medium">æ­£åœ¨åŠ è½½æ•°æ®...</p>
                </div>
              </div>
            );
          }

          // é”™è¯¯çŠ¶æ€
          if (error) {
            return (
              <div className="flex h-screen bg-[#F0F2F5] items-center justify-center">
                <div className="text-center max-w-md">
                  <AlertCircle className="mx-auto text-red-500 mb-4" size={48} />
                  <h2 className="text-xl font-bold text-slate-900 mb-2">æ•°æ®åŠ è½½å¤±è´¥</h2>
                  <p className="text-slate-600 mb-4">{error}</p>
                  <button 
                    onClick={() => window.location.reload()} 
                    className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                  >
                    é‡æ–°åŠ è½½
                  </button>
                </div>
              </div>
            );
          }

          // æ•°æ®ä¸ºç©ºçŠ¶æ€
          if (!loading && data.length === 0) {
            return (
              <div className="flex h-screen bg-[#F0F2F5] items-center justify-center">
                <div className="text-center max-w-md">
                  <Database className="mx-auto text-slate-400 mb-4" size={48} />
                  <h2 className="text-xl font-bold text-slate-900 mb-2">æš‚æ— æ•°æ®</h2>
                  <p className="text-slate-600">JSONæ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°åˆ†ææ•°æ®</p>
                </div>
              </div>
            );
          }

          return (
            <div className="flex h-screen bg-[#F0F2F5] font-sans text-slate-900 overflow-hidden selection:bg-blue-100 selection:text-blue-900 relative">
              
              {/* Mobile Overlay - åªåœ¨ç§»åŠ¨ç«¯ä¸”ä¾§è¾¹æ å±•å¼€æ—¶æ˜¾ç¤º */}
              <div 
                className={`md:hidden fixed inset-0 bg-black/20 overlay z-10 transition-opacity ${
                  sidebarCollapsed ? 'opacity-0 pointer-events-none' : 'opacity-100'
                }`}
                onClick={() => setSidebarCollapsed(true)}
              ></div>
              
              {/* Left Sidebar: List View */}
              <div className={`
                fixed md:relative
                bg-white border-r border-slate-200 
                flex flex-col h-full z-20 shadow-xl
                transition-all duration-300 ease-in-out
                ${sidebarCollapsed 
                  ? '-translate-x-full md:translate-x-0 w-full md:w-0 md:border-0 md:shadow-none' 
                  : 'translate-x-0 w-full md:w-[420px] lg:w-[480px]'
                }
              `}>
                {/* Header */}
                <div className="p-6 border-b border-slate-100 bg-white">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center space-x-2">
                        <div className="w-8 h-8 bg-slate-900 rounded-lg flex items-center justify-center shadow-lg shadow-slate-200">
                            <Activity size={16} className="text-white" />
                        </div>
                        <div>
                            <h1 className="text-sm font-bold text-slate-900">AITO å£°èª‰ç›‘æµ‹</h1>
                            <p className="text-[10px] text-slate-400 uppercase tracking-wider">Intelligence Pro</p>
                        </div>
                    </div>
                    <button 
                      onClick={() => setSidebarCollapsed(true)}
                      className="p-2 rounded-lg hover:bg-slate-100 transition-colors text-slate-600 hover:text-slate-900"
                      title="æŠ˜å ä¾§è¾¹æ "
                    >
                      <ChevronLeft size={20} />
                    </button>
                  </div>
                  
                  {/* Stats Cards */}
                  <div className="grid grid-cols-3 gap-3 mt-2">
                    <button onClick={() => setFilterStatus('high')} className={`p-3 rounded-xl border flex flex-col items-center transition-all ${filterStatus === 'high' ? 'bg-red-50 border-red-200 ring-2 ring-red-100' : 'bg-white border-slate-100 hover:border-red-100 hover:bg-red-50/50'}`}>
                      <span className="text-[10px] font-bold text-red-500 uppercase mb-1">é«˜å±</span>
                      <span className="text-2xl font-bold text-slate-800">{highRisk}</span>
                    </button>
                    <button onClick={() => setFilterStatus('warning')} className={`p-3 rounded-xl border flex flex-col items-center transition-all ${filterStatus === 'warning' ? 'bg-amber-50 border-amber-200 ring-2 ring-amber-100' : 'bg-white border-slate-100 hover:border-amber-100 hover:bg-amber-50/50'}`}>
                      <span className="text-[10px] font-bold text-amber-500 uppercase mb-1">é¢„è­¦</span>
                      <span className="text-2xl font-bold text-slate-800">{warning}</span>
                    </button>
                    <button onClick={() => setFilterStatus('safe')} className={`p-3 rounded-xl border flex flex-col items-center transition-all ${filterStatus === 'safe' ? 'bg-emerald-50 border-emerald-200 ring-2 ring-emerald-100' : 'bg-white border-slate-100 hover:border-emerald-100 hover:bg-emerald-50/50'}`}>
                      <span className="text-[10px] font-bold text-emerald-500 uppercase mb-1">å®‰å…¨</span>
                      <span className="text-2xl font-bold text-slate-800">{safe}</span>
                    </button>
                  </div>
                </div>

                {/* Filter Info Bar */}
                <div className="px-6 py-2 bg-slate-50 border-b border-slate-100 flex justify-between items-center text-xs text-slate-500">
                    <span className="flex items-center"><Filter size={12} className="mr-1.5"/> {filterStatus === 'all' ? 'å…¨éƒ¨æ•°æ®' : filterStatus === 'high' ? 'é«˜å±æ•°æ®' : filterStatus === 'warning' ? 'é¢„è­¦æ•°æ®' : 'å®‰å…¨æ•°æ®'}</span>
                    <span className="font-mono opacity-60">{filteredData.length} æ¡è®°å½•</span>
                </div>

                {/* Scrollable List */}
                <div className="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-3 bg-slate-50/50">
                  {filteredData.map((item) => (
                    <div 
                      key={item.id}
                      onClick={() => {
                        setSelectedId(item.id);
                        // åœ¨ç§»åŠ¨ç«¯ç‚¹å‡»åè‡ªåŠ¨æŠ˜å ä¾§è¾¹æ æ˜¾ç¤ºè¯¦æƒ…
                        if (window.innerWidth < 768) {
                          setSidebarCollapsed(true);
                          setShowDetailOnMobile(true);
                        }
                      }}
                      className={`group p-4 rounded-xl cursor-pointer transition-all duration-200 border relative ${
                        selectedId === item.id 
                          ? 'bg-white shadow-md border-blue-500/40 ring-1 ring-blue-500/10 z-10' 
                          : 'bg-white border-slate-200/60 hover:border-slate-300 hover:shadow-sm'
                      }`}
                    >
                      {selectedId === item.id && <div className="absolute left-0 top-4 bottom-4 w-1 bg-blue-500 rounded-r-full"></div>}
                      
                      <div className="flex justify-between items-start mb-2">
                        <div className="flex items-center space-x-2 pl-2">
                          <CategoryIcon category={item.category} />
                          <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">{item.category}</span>
                        </div>
                        <div className={`w-2 h-2 rounded-full ${
                            item.analysis.security.status === 'high' ? 'bg-red-500' : 
                            item.analysis.security.status === 'warning' ? 'bg-amber-500' : 'bg-emerald-500'
                        }`}></div>
                      </div>
                      
                      <h3 className={`text-[13px] font-medium leading-relaxed pl-2 ${selectedId === item.id ? 'text-slate-900' : 'text-slate-600 group-hover:text-slate-900'}`}>
                        {item.query}
                      </h3>
                      
                      <div className="flex items-center justify-between mt-3 pl-2">
                          <div className="flex items-center space-x-2">
                            <span className="text-[10px] px-1.5 py-0.5 rounded bg-slate-100 text-slate-500 font-medium">{item.platform}</span>
                          </div>
                          <span className={`text-[10px] font-bold ${
                              item.analysis.security.status === 'high' ? 'text-red-500' : 
                              item.analysis.security.status === 'warning' ? 'text-amber-500' : 'text-emerald-600'
                          }`}>
                              {item.analysis.security.label}
                          </span>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Right Main Content */}
              <div className="flex-1 h-full flex flex-col bg-[#F0F2F5] overflow-hidden relative">
                 {/* Background Pattern */}
                 <div className="absolute inset-0 opacity-[0.02] pointer-events-none" style={{backgroundImage: 'radial-gradient(#475569 1px, transparent 1px)', backgroundSize: '24px 24px'}}></div>

                 {/* Toggle Sidebar Button - æ˜¾ç¤ºåœ¨ä¾§è¾¹æ æŠ˜å æ—¶ */}
                 {sidebarCollapsed && (
                   <button 
                     onClick={() => setSidebarCollapsed(false)}
                     className="fixed top-4 left-4 z-30 p-3 rounded-xl bg-white shadow-lg border border-slate-200 hover:bg-slate-50 transition-all hover:shadow-xl text-slate-700 hover:text-slate-900"
                     title="å±•å¼€ä¾§è¾¹æ "
                   >
                     <Menu size={20} />
                   </button>
                 )}

                <div className="flex-1 overflow-y-auto custom-scrollbar p-4 md:p-8 lg:p-12 flex flex-col items-center w-full">
                  {/* ç§»åŠ¨ç«¯ç©ºçŠ¶æ€ - æç¤ºç”¨æˆ·ç‚¹å‡»èœå•é€‰æ‹© */}
                  {!selectedItem && (
                    <div className="flex items-center justify-center h-full w-full md:hidden">
                      <div className="text-center px-8">
                        <Menu className="mx-auto text-slate-300 mb-4" size={48} />
                        <p className="text-slate-500 text-sm">è¯·ç‚¹å‡»å·¦ä¸Šè§’èœå•å›¾æ ‡é€‰æ‹©è¦æŸ¥çœ‹çš„é¡¹ç›®</p>
                      </div>
                    </div>
                  )}
                  
                  {selectedItem && (
                  <div className="w-full max-w-5xl animate-fade-in-up">
                    
                    {/* Header Info */}
                    <div className="flex justify-between items-center mb-6 px-2">
                        <div className="flex items-center space-x-3">
                            <div className="h-8 w-8 rounded-full bg-white shadow-sm flex items-center justify-center border border-slate-100 text-slate-400 font-mono text-xs">
                                #{selectedItem?.id.toString().padStart(2, '0')}
                            </div>
                            <div className="flex flex-col">
                                <span className="text-[10px] uppercase font-bold text-slate-400 tracking-widest">Data Source</span>
                                <span className="text-xs font-medium text-slate-600">{selectedItem?.sourceFile}</span>
                            </div>
                        </div>
                        <StatusBadge status={selectedItem?.analysis?.security?.status} text={selectedItem?.analysis?.security?.label} />
                    </div>

                    {/* Main Card: Question & Answer */}
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-6">
                      <div className="p-8 border-b border-slate-100">
                        <h2 className="text-xl font-bold text-slate-900 leading-normal flex items-start">
                            <MessageSquare className="text-blue-500 mt-1 mr-3 flex-shrink-0" size={20} />
                            {selectedItem?.query}
                        </h2>
                      </div>
                      
                      <div className="p-8 bg-slate-50/50">
                        <div className="relative">
                            <div className="absolute -left-4 top-0 bottom-0 w-1 bg-slate-200 rounded-full"></div>
                            <div className="flex items-center space-x-2 mb-3">
                                <div className="flex items-center space-x-1.5 bg-white border border-slate-200 rounded-full px-2 py-1 shadow-sm">
                                    <Smartphone size={10} className="text-slate-400"/>
                                    <span className="text-[10px] font-bold text-slate-600 uppercase">{selectedItem?.platform} å›ç­”</span>
                                </div>
                            </div>
                            <p className="text-[15px] leading-7 text-slate-700 text-justify">
                                {selectedItem?.response}
                            </p>
                        </div>
                      </div>
                    </div>

                    {/* Analysis Grid */}
                    {selectedItem?.analysis && (
                    <div className="grid grid-cols-12 gap-6">
                      
                      {/* Left: Security & Diagnosis (4 cols) */}
                      <div className="col-span-12 lg:col-span-4 space-y-6">
                        <div className={`rounded-2xl p-6 border h-full shadow-sm flex flex-col relative overflow-hidden ${
                            selectedItem.analysis.security.status === 'high' ? 'bg-white border-red-200' : 
                            selectedItem.analysis.security.status === 'warning' ? 'bg-white border-amber-200' : 'bg-white border-emerald-200'
                        }`}>
                          <div className={`absolute top-0 left-0 right-0 h-1.5 ${
                              selectedItem.analysis.security.status === 'high' ? 'bg-red-500' : 
                              selectedItem.analysis.security.status === 'warning' ? 'bg-amber-500' : 'bg-emerald-500'
                          }`}></div>
                          
                          <div className="mb-6">
                            <div className="flex items-center space-x-2 mb-2">
                                <span className="text-[10px] font-bold uppercase tracking-widest text-slate-400">Risk Diagnosis</span>
                            </div>
                            <h3 className={`text-2xl font-bold ${
                                selectedItem.analysis.security.status === 'high' ? 'text-red-600' : 
                                selectedItem.analysis.security.status === 'warning' ? 'text-amber-600' : 'text-emerald-600'
                            }`}>
                                {selectedItem.analysis.diagnosis}
                            </h3>
                          </div>
                          
                          <div className="mt-auto pt-6 border-t border-dashed border-slate-200">
                             <div className="flex items-start space-x-2">
                                <AlertCircle size={14} className="text-slate-400 mt-0.5 flex-shrink-0" />
                                <p className="text-xs text-slate-500 leading-5">
                                  {selectedItem.analysis.security.reason}
                                </p>
                             </div>
                          </div>
                        </div>
                      </div>

                      {/* Right: 5C Dimensions (8 cols) */}
                      <div className="col-span-12 lg:col-span-8 bg-white rounded-2xl shadow-sm border border-slate-200 p-8">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-x-10 gap-y-10">
                          
                          {/* 1. Fact Check */}
                          <DetailSection title="äº‹å®æ ¸æŸ¥ (Fact Check)" icon={CheckCircle2}>
                            <div className="flex items-start p-3 bg-slate-50 rounded-lg border border-slate-100">
                              <div className={`mt-1.5 w-2 h-2 rounded-full mr-2.5 flex-shrink-0 ${selectedItem.analysis.factCheck.status === 'accurate' ? 'bg-emerald-500' : 'bg-red-500'}`}></div>
                              <span className="text-slate-700 font-medium text-[13px]">{selectedItem.analysis.factCheck.text}</span>
                            </div>
                          </DetailSection>

                          {/* 2. Brand Impression */}
                          <DetailSection title="å“ç‰Œå°è±¡ (Brand Impression)" icon={Heart}>
                              <div className="flex items-center space-x-1 mb-3">
                                {[1,2,3,4,5].map(score => (
                                  <div key={score} className={`h-1.5 flex-1 rounded-full ${score <= selectedItem.analysis.brandImpression.score ? 'bg-rose-500' : 'bg-slate-100'}`}></div>
                                ))}
                              </div>
                              <span className="inline-block bg-rose-50 text-rose-700 text-[10px] font-bold px-2 py-0.5 rounded mb-2">{selectedItem.analysis.brandImpression.label}</span>
                              <p className="text-slate-600 text-xs">{selectedItem.analysis.brandImpression.text}</p>
                          </DetailSection>

                          {/* 3. Competitive Position */}
                          <DetailSection title="ç«å“ç«™ä½ (Comp Position)" icon={TrendingUp}>
                              <div className="flex items-center mb-3">
                                {selectedItem.analysis.compPosition.trend === 'up' && <span className="flex items-center text-emerald-700 text-[11px] font-bold bg-emerald-50 px-2.5 py-1 rounded-md border border-emerald-100"><TrendingUp size={12} className="mr-1.5"/> ä¼˜åŠ¿ä½ (Advantaged)</span>}
                                {selectedItem.analysis.compPosition.trend === 'down' && <span className="flex items-center text-red-700 text-[11px] font-bold bg-red-50 px-2.5 py-1 rounded-md border border-red-100"><TrendingUp size={12} className="mr-1.5 rotate-180"/> åŠ£åŠ¿ä½ (Disadvantaged)</span>}
                                {selectedItem.analysis.compPosition.trend === 'neutral' && <span className="flex items-center text-slate-600 text-[11px] font-bold bg-slate-50 px-2.5 py-1 rounded-md border border-slate-200"><Activity size={12} className="mr-1.5"/> å‡åŠ¿ä½ (Neutral)</span>}
                              </div>
                              <p className="text-slate-600 text-[13px]">{selectedItem.analysis.compPosition.text}</p>
                          </DetailSection>

                          {/* 4. Strategy Action */}
                          <DetailSection title="è¡ŒåŠ¨å»ºè®® (Action)" icon={Zap} className="!mb-0">
                            <div className="group/card relative cursor-default">
                              <div className="absolute inset-0 bg-blue-100 rounded-lg transform rotate-1 opacity-0 group-hover/card:opacity-100 transition-opacity"></div>
                              <div className="relative text-blue-900 font-medium text-[13px] bg-blue-50 border border-blue-100 rounded-lg p-4 border-l-[3px] border-l-blue-500 leading-6 shadow-sm group-hover/card:-translate-y-0.5 transition-transform">
                                {selectedItem.analysis.strategy}
                              </div>
                            </div>
                          </DetailSection>

                        </div>
                      </div>
                    </div>
                    )}

                    {/* Footer */}
                    <div className="mt-12 mb-6 text-center">
                        <p className="text-[10px] font-bold text-slate-300 uppercase tracking-[0.3em]">System V3.0 â€¢ 2025 AITO Analysis</p>
                    </div>

                  </div>
                  )}
                </div>
              </div>
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>